<div class="row">
    <div class="col-md-12">
      <button data-ng-class="controller.tradermainSrv.isWorking? 'btn btn-danger pull-right':'btn btn-success pull-right'" data-ng-click="controller.fnToggleWork()">
        {{controller.tradermainSrv.isWorking?'Stop Working':'Start work'}}
      </button>
    </div>
    <div class="col-md-12">
        <accordion close-others="oneAtATime">
            <accordion-group ng-repeat="service in controller.tradermainSrv.arrayServicesAttending">
                <accordion-heading>
                    Service (<span data-ng-bind="service.service._id"></span>): <mark data-ng-bind="service.service.gambler.username"></mark>
                </accordion-heading>
                <div class="row">
                    <div class="col-md-12">
                        <table class="table table-striped table-condensed">
                          <thead>
                              <tr>
                                  <th>Gambler</th>
                                  <th>Type</th>
                                  <th>Description</th>
                                  <th>State</th>
                                  <th>Created Date</th>
                                  <th>Updated Date</th>
                              </tr>
                          </thead>
                          <tbody>
                              <tr>
                                <td>
                                  <span data-ng-bind="service.service.gambler.username"></span>
                                </td>
                                <td>
                                  <span data-ng-bind="service.service.type"></span>
                                </td>
                                <td>
                                  <span data-ng-bind="service.service.amount"></span>
                                  &nbsp;
                                  <span data-ng-bind="service.service.sourceCurrency"></span>
                                  &nbsp;to&nbsp;
                                  <span data-ng-bind="service.service.destinationCurrency"></span>
                                </td>
                                <td>
                                  <div ng-switch="service.service.state">
                                    <span ng-switch-when="CREATED" data-ng-bind="service.service.state" data-toggle="tooltip" title="Waiting for a Trader" class="label label-primary"></span>
                                    <span ng-switch-when="ASSIGNED" data-ng-bind="service.service.state" data-toggle="tooltip" title="Trader has been assigned"></span>
                                    <span ng-switch-when="COMPLETED" data-ng-bind="service.service.state" data-toggle="tooltip" title="Service has been completed"></span>
                                    <span ng-switch-when="CANCELED" data-ng-bind="service.service.state" data-toggle="tooltip" title="User has canceled the service" class="label label-danger"></span>
                                    <span ng-switch-when="DESISTED" data-ng-bind="service.service.state" data-toggle="tooltip" title="User desisted the service"></span>
                                </div>
                                </td>
                                <td>
                                  <span data-ng-bind="service.service.createdDate | date:'medium'"></span>
                                </td>
                                <td>
                                  <span data-ng-bind="service.service.updatedDate | date:'medium'"></span>
                                </td>
                              </tr>
                          </tbody>
                        </table>                
                    </div>  
                    <div class="col-md-12">
                      <div class="panel panel-default">
                        <div class="panel-heading">
                          Chat with Trader
                        </div>
                        <div id="chatPanelService" class="panel-body" jm-autoscroll>
                          <!-- {{controller.tradermainSrv.listServicesAttending[service.service._id].listChatMessages.length}} -->
                          <div class="row" data-ng-repeat="message in controller.tradermainSrv.listServicesAttending[service.service._id].listChatMessages track by $index">
                            <div class="col-md-12">
                              <small>
                                  <mark data-ng-bind="message.username"></mark>
                                  <span data-ng-bind="message.message" data-ng-class="message.type === 'INFO' ? 'text-info':''"></span>
                              </small>
                            </div>
                          </div>
                        </div>
                        <div class="panel-footer">
                          <form class="form-horizontal" autocomplete="off" data-ng-submit="controller.fnSendMessage(service.service)">
                            <div class="input-group">
                              <input type="text" data-ng-model="service.service.message" class="form-control" placeholder="Write to the trader...">
                              <span class="input-group-btn">
                                <button class="btn btn-default" type="submit">Send</button>
                              </span>
                              </div>
                          </form>
                        </div>
                      </div>
                      <div class="col-md-12 text-center">
                        <button class="btn btn-success" data-ng-click="controller.fnApplyService(service.service)">
                          Apply
                        </button>
                      </div>                    
                    </div>
                </div>
            </accordion-group>
        </accordion>
    </div>
</div>